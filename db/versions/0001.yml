version: 1
migrationScript: |-
  begin
    create table secrets (
      name text primary key,
      secret text
    );
  end
methods:
  get_secret:
    description: |-
      Read the secret associated with some key. If the secret has recently expired, the response code 410 is returned.
      If the caller lacks the scope necessary to get the secret, the call will fail with a 403 code regardless of
      whether the secret exists.
    mode: read
    serviceName: secrets
    args: name text
    returns: table (secret text)
    body: |-
      begin
        return query select secrets.secret from secrets where secrets.name = get_secret.name;
      end
  list_secrets:
    description: |-
      List the names of all secrets.
      By default this end-point will try to return up to 1000 secret names in one request. But it may return less,
      even if more tasks are available. It may also return a `continuationToken` even though there are no more results.
      However, you can only be sure to have seen all results if you keep calling `listTaskGroup` with the last
      `continuationToken` until you get a result without a `continuationToken`. If you are not interested in listing
      all the members at once, you may use the query-string option `limit` to return fewer.
    mode: read
    serviceName: secrets
    args: ''
    returns: table (name text)
    body: |-
      begin
        return query select secrets.name as name from secrets;
      end
  remove_secret:
    description: |-
      Delete the secret associated with some key.
    mode: write
    serviceName: secrets
    args: name text
    returns: void
    body: |-
      begin
        delete from secrets where secrets.name = remove_secret.name;
      end
  set_secret:
    description: |-
      Set the secret associated with some key. If the secret already exists, it is updated instead.
    mode: write
    serviceName: secrets
    args: name text, secret text
    returns: void
    body: |-
      begin
        insert into secrets values (set_secret.name, set_secret.secret)
        on conflict (name) do
          update set secret=EXCLUDED.secret;
      end
